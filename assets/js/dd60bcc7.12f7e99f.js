"use strict";(self.webpackChunkreplibyte=self.webpackChunkreplibyte||[]).push([[75],{3905:function(e,t,a){a.d(t,{Zo:function(){return u},kt:function(){return c}});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),m=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},u=function(e){var t=m(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=m(a),c=r,k=d["".concat(l,".").concat(c)]||d[c]||p[c]||o;return a?n.createElement(k,i(i({ref:t},u),{},{components:a})):n.createElement(k,i({ref:t},u))}));function c(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=a.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var m=2;m<o;m++)i[m]=a[m];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},3513:function(e,t,a){a.r(t),a.d(t,{assets:function(){return u},contentTitle:function(){return l},default:function(){return c},frontMatter:function(){return s},metadata:function(){return m},toc:function(){return p}});var n=a(7462),r=a(3366),o=(a(7294),a(3905)),i=["components"],s={title:"I. Create a dump",sidebar_position:1},l="Create a dump",m={unversionedId:"guides/create-a-dump",id:"guides/create-a-dump",title:"I. Create a dump",description:"I assume you have Installed Replibyte and you Read the concepts.",source:"@site/docs/guides/1-create-a-dump.md",sourceDirName:"guides",slug:"/guides/create-a-dump",permalink:"/docs/guides/create-a-dump",editUrl:"https://github.com/Qovery/replibyte/tree/main/website/docs/guides/1-create-a-dump.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"I. Create a dump",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"Transformers",permalink:"/docs/transformers"},next:{title:"II. Restore a dump",permalink:"/docs/guides/restore-a-dump"}},u={},p=[{value:"Configuration",id:"configuration",level:2},{value:"Option 1: make a dump with Replibyte",id:"option-1-make-a-dump-with-replibyte",level:3},{value:"Option 2: Make a dump manually",id:"option-2-make-a-dump-manually",level:3},{value:"Option 3: You already have a dump",id:"option-3-you-already-have-a-dump",level:3},{value:"Hide sensitive data with Transformers",id:"hide-sensitive-data-with-transformers",level:2},{value:"Run",id:"run",level:2}],d={toc:p};function c(e){var t=e.components,a=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"create-a-dump"},"Create a dump"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"hello \ud83d\udc4b\ud83c\udffc")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"I assume you have ",(0,o.kt)("a",{parentName:"p",href:"/docs/getting-started/installation"},"Installed Replibyte")," and you Read the ",(0,o.kt)("a",{parentName:"p",href:"/docs/getting-started/concepts"},"concepts"),"."))),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("p",null,"To use Replibyte, you need to use to a dump from your production database. Here are three options:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Option 1 (easiest)"),": You don't, and you want Replibyte to make a dump."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Option 2"),": You don't, and you want to make a dump manually."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Option 3"),": You already have a dump from your database.")),(0,o.kt)("h3",{id:"option-1-make-a-dump-with-replibyte"},"Option 1: make a dump with Replibyte"),(0,o.kt)("p",null,"To let Replibyte creating a dump from your database for you, you need to update your ",(0,o.kt)("inlineCode",{parentName:"p"},"conf.yaml")," file with the source connection URI from your production database as a property."),(0,o.kt)("p",null,"Pick the example that fit the database you are using."),(0,o.kt)("details",null,(0,o.kt)("summary",null,"PostgreSQL"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"source:\n  connection_uri: postgres://[user]:[password]@[host]:[port]/[database]\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"MySQL"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"source:\n  connection_uri: mysql://[user]:[password]@[host]:[port]/[database]\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"MongoDB"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"source:\n  connection_uri: mongo://[user]:[password]@[host]:[port]/[database]\n"))),(0,o.kt)("p",null,"or you can also use an environment variable"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="With an environment variable"',title:'"With',an:!0,environment:!0,'variable"':!0},"source:\n  connection_uri: $DATABASE_URL\n")),(0,o.kt)("h3",{id:"option-2-make-a-dump-manually"},"Option 2: Make a dump manually"),(0,o.kt)("p",null,"Here are the commands to dump your database yourself"),(0,o.kt)("details",null,(0,o.kt)("summary",null,"PostgreSQL"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"pg_dump --column-inserts --no-owner -h [host] -p [port] -U [username] [database]\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"MySQL"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"mysqldump -h [host] -P [port] -u [username] -p --add-drop-database --add-drop-table --skip-extended-insert --complete-insert --single-transaction --quick --databases\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"MongoDB"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"mongodump -h [host] --port [port] --authenticationDatabase [auth_db|default: admin] --db [database] -u [username] -p [password] --archive\n"))),(0,o.kt)("h3",{id:"option-3-you-already-have-a-dump"},"Option 3: You already have a dump"),(0,o.kt)("p",null,"You have nothing to do, but it is possible that some options are missing from your dump, then you'll need to use the ",(0,o.kt)("a",{parentName:"p",href:"#option-2-make-a-dump-manually"},"option 2")),(0,o.kt)("h2",{id:"hide-sensitive-data-with-transformers"},"Hide sensitive data with Transformers"),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"A MongoDB ",(0,o.kt)("inlineCode",{parentName:"p"},"Collection")," can be associated to a SQL ",(0,o.kt)("inlineCode",{parentName:"p"},"table"),", and a ",(0,o.kt)("inlineCode",{parentName:"p"},"Document")," to a ",(0,o.kt)("inlineCode",{parentName:"p"},"table row"),". "))),(0,o.kt)("p",null,"By using ",(0,o.kt)("a",{parentName:"p",href:"/docs/transformers"},"Transformers"),", you can change on the fly your database data. Let's say we have the following structure for a table ",(0,o.kt)("inlineCode",{parentName:"p"},"employees")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"CREATE TABLE public.customers (\n    id bpchar NOT NULL,\n    first_name character varying(30) NOT NULL,\n    last_name character varying(30) NOT NULL,\n    contact_email character varying(2048) NOT NULL,\n    contact_phone character varying(24)\n);\n")),(0,o.kt)("p",null,"with the following entries:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sql"},"INSERT INTO public.customers (id, first_name, last_name, contact_email, contact_phone) VALUES ('ALFKI', 'Maria', 'Anders', 'maria.anders@gmail.com', '030-0074321');\nINSERT INTO public.customers (id, first_name, last_name, contact_email, contact_phone) VALUES ('ANATR', 'Ana', 'Trujillo', 'ana@factchecker.com', '(5) 555-4729');\nINSERT INTO public.customers (id, first_name, last_name, contact_email, contact_phone) VALUES ('ANTON', 'Antonio', 'Moreno', 'anto.moreno@gmail.com', NULL);\n")),(0,o.kt)("p",null,"and you want to hide the ",(0,o.kt)("inlineCode",{parentName:"p"},"first_name"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"last_name"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"contact_email")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"contact_phone")," fields. You can use the following configuration in your ",(0,o.kt)("inlineCode",{parentName:"p"},"conf.yaml")," file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="source and transformers in your conf.yaml"',title:'"source',and:!0,transformers:!0,in:!0,your:!0,'conf.yaml"':!0},"source:\n  connection_uri: postgres://user:password@host:port/db\n  transformers:\n    - database: public\n      table: customers\n      columns:\n        - name: first_name\n          transformer_name: first-name\n        - name: last_name\n          transformer_name: random\n        - name: contact_phone\n          transformer_name: phone-number\n        - name: contact_email\n          transformer_name: email\n")),(0,o.kt)("p",null,"By using Transformers, you keep your sensitive data safe of being leaked. "),(0,o.kt)("h2",{id:"run"},"Run"),(0,o.kt)("p",null,"It's the big day! Let's ",(0,o.kt)("strong",{parentName:"p"},"run and upload")," our transformed dump. But wait, something is missing. If you read about the ",(0,o.kt)("a",{parentName:"p",href:"/docs/getting-started/concepts"},"concepts"),", and ",(0,o.kt)("a",{parentName:"p",href:"/docs/how-replibyte-works"},"how Replibyte works"),", you know that a ",(0,o.kt)("a",{parentName:"p",href:"/docs/getting-started/concepts#datastore"},"Datastore")," is required to upload the transformed dump. Here is the lines you need to add in your ",(0,o.kt)("inlineCode",{parentName:"p"},"conf.yaml")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="Add your datastore in your conf.yaml"',title:'"Add',your:!0,datastore:!0,in:!0,'conf.yaml"':!0},"datastore:\n  bucket: my-replibyte-dumps\n  region: us-east-2\n  access_key_id: $ACCESS_KEY_ID\n  secret_access_key: $AWS_SECRET_ACCESS_KEY\n  # endpoint: # UNCOMMENT to use another S3 compatible service than AWS S3 \n  #   custom: 'https://storage.googleapis.com/storage/v1' # E.g. endpoint for GCP\n")),(0,o.kt)("p",null,"Here the datastore is a S3 bucket where the dump will be stored and accessible for future restore (next guide)."),(0,o.kt)("p",null,"The final ",(0,o.kt)("inlineCode",{parentName:"p"},"conf.yaml")," to create a final transformed dump looks like this:"),(0,o.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Do not forget to change your bucket name!"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="conf.yaml"',title:'"conf.yaml"'},"source:\n  connection_uri: postgres://user:password@host:port/db # optional - use only for option #1\n  transformers:\n    - database: public\n      table: customers\n      columns:\n        - name: first_name\n          transformer_name: first-name\n        - name: last_name\n          transformer_name: random\n        - name: contact_phone\n          transformer_name: phone-number\n        - name: contact_email\n          transformer_name: email\ndatastore:\n  bucket: my-replibyte-dumps\n  region: us-east-2\n  access_key_id: $ACCESS_KEY_ID\n  secret_access_key: $AWS_SECRET_ACCESS_KEY\n")),(0,o.kt)("p",null,"Finally, you can run the following command according to you chosen option above:"),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Option 1: Make a dump with Replibyte"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"replibyte -c conf.yaml dump create\n"))),(0,o.kt)("details",null,(0,o.kt)("summary",null,"Option 2 and 3: Create a transformed dump from a dump file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"cat your_dump.sql | replibyte -c conf.yaml dump create -i\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"-i")," parameter is required to read the data from the input.")),(0,o.kt)("hr",null),(0,o.kt)("p",null,"Now, it's time to look at how to restore your transformed dump \u27a1\ufe0f"))}c.isMDXComponent=!0}}]);